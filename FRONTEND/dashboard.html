<!DOCTYPE html>
<html>
<head>
    <title>Dashboard | Biashara-POS</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body class="bg-light">

    <nav class="navbar navbar-expand-lg navbar-dark bg-dark px-3">
        <a class="navbar-brand fw-bold" href="dashboard.html">Biashara-POS</a>
        <div class="ms-auto">
            <a href="login.html" class="btn btn-outline-light btn-sm">Logout</a>
        </div>
    </nav>

    <div class="container-fluid">
        <div class="row">
            <div class="col-md-2 bg-white min-vh-100 shadow-sm pt-3">
                <ul class="nav flex-column">
                    <li class="nav-item mb-2">
                        <a href="dashboard.html" class="nav-link active text-primary fw-bold">
                            <i class="fas fa-home me-2"></i> Dashboard
                        </a>
                    </li>
                    <li class="nav-item mb-2">
                        <a href="pos.html" class="nav-link text-dark">
                            <i class="fas fa-cash-register me-2"></i> POS Terminal
                        </a>
                    </li>
                    <li class="nav-item mb-2">
                        <a href="products.html" class="nav-link text-dark">
                            <i class="fas fa-box me-2"></i> Inventory
                        </a>
                    </li>
                </ul>
            </div>

            <div class="col-md-10 p-4">
                <h2 class="mb-4">Store Overview</h2>
                
                <div class="row mb-4">
                    <div class="col-md-3">
                        <div class="card text-white bg-primary mb-3">
                            <div class="card-body">
                                <h5 class="card-title">Total Products</h5>
                                <h2 class="fw-bold" id="totalProducts">0</h2>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="card text-white bg-success mb-3">
                            <div class="card-body">
                                <h5 class="card-title">In Stock</h5>
                                <h2 class="fw-bold" id="totalStock">0</h2>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="card text-white bg-warning mb-3">
                            <div class="card-body">
                                <h5 class="card-title">Low Stock Items</h5>
                                <h2 class="fw-bold" id="lowStock">0</h2>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="card text-white bg-info mb-3">
                            <div class="card-body">
                                <h5 class="card-title">Total Value</h5>
                                <h2 class="fw-bold" id="totalValue">KES 0</h2>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="row">
                    <div class="col-md-6 mb-3">
                        <div class="card shadow-sm">
                            <div class="card-header bg-white fw-bold">Quick Actions</div>
                            <div class="card-body">
                                <div class="d-grid gap-2">
                                    <a href="pos.html" class="btn btn-primary btn-lg">
                                        <i class="fas fa-cash-register me-2"></i> Open POS Terminal
                                    </a>
                                    <a href="products.html" class="btn btn-outline-primary">
                                        <i class="fas fa-box me-2"></i> Manage Inventory
                                    </a>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="col-md-6 mb-3">
                        <div class="card shadow-sm">
                            <div class="card-header bg-white fw-bold">Recent Products</div>
                            <div class="card-body">
                                <ul class="list-group list-group-flush" id="recentProducts">
                                    <li class="list-group-item text-center text-muted">
                                        <div class="spinner-border spinner-border-sm" role="status">
                                            <span class="visually-hidden">Loading...</span>
                                        </div>
                                        Loading products...
                                    </li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        const API_URL = 'http://localhost:8080/api';

        // Load dashboard data on page load
        document.addEventListener('DOMContentLoaded', function() {
            loadDashboardData();
        });

        function loadDashboardData() {
            fetch(`${API_URL}/products`)
                .then(response => response.json())
                .then(products => {
                    updateStatistics(products);
                    displayRecentProducts(products);
                })
                .catch(error => {
                    console.error('Error loading dashboard data:', error);
                    document.getElementById('recentProducts').innerHTML = `
                        <li class="list-group-item text-center text-danger">
                            <small>Backend not running. Start server to see data.</small>
                        </li>`;
                });
        }

        function updateStatistics(products) {
            const totalProducts = products.length;
            const totalStock = products.reduce((sum, p) => sum + p.quantity, 0);
            const lowStock = products.filter(p => p.quantity < 5).length;
            const totalValue = products.reduce((sum, p) => sum + (p.sellingPrice * p.quantity), 0);

            document.getElementById('totalProducts').textContent = totalProducts;
            document.getElementById('totalStock').textContent = totalStock;
            document.getElementById('lowStock').textContent = lowStock;
            document.getElementById('totalValue').textContent = 'KES ' + totalValue.toFixed(2);
        }

        function displayRecentProducts(products) {
            const recentProducts = document.getElementById('recentProducts');
            
            if (products.length === 0) {
                recentProducts.innerHTML = `
                    <li class="list-group-item text-center text-muted">
                        No products yet. <a href="products.html">Add some products</a>
                    </li>`;
                return;
            }

            const recent = products.slice(-5).reverse();
            recentProducts.innerHTML = recent.map(product => `
                <li class="list-group-item d-flex justify-content-between align-items-center">
                    <div>
                        <strong>${product.name}</strong>
                        <br><small class="text-muted">KES ${product.sellingPrice.toFixed(2)}</small>
                    </div>
                    <span class="badge ${product.quantity < 5 ? 'bg-danger' : 'bg-success'} rounded-pill">
                        ${product.quantity}
                    </span>
                </li>
            `).join('');
        }
    </script>
</body>
</html>
