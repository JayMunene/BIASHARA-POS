<!DOCTYPE html>
<html>
<head>
    <title>Inventory Manager | Biashara-POS</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        body { background-color: #f4f6f9; }
        .table-card { border-radius: 10px; border: none; }
    </style>
</head>
<body>
    
    <nav class="navbar navbar-dark bg-dark px-3 mb-4">
        <a class="navbar-brand fw-bold" href="dashboard.html">Biashara-POS</a>
        <div class="ms-auto">
            <a href="dashboard.html" class="text-white text-decoration-none me-3">Dashboard</a>
            <a href="login.html" class="text-white text-decoration-none">Logout</a>
        </div>
    </nav>

    <div class="container">
        <div class="d-flex justify-content-between align-items-center mb-4">
            <div>
                <h2 class="fw-bold text-primary">ðŸ“¦ Inventory</h2>
                <p class="text-muted">Manage your shop's products and stock levels.</p>
            </div>
            <button class="btn btn-primary btn-lg" data-bs-toggle="modal" data-bs-target="#addProductModal">
                <i class="fas fa-plus-circle me-2"></i> Add New Product
            </button>
        </div>

        <div class="card shadow-sm table-card">
            <div class="card-body p-0">
                <table class="table table-striped table-hover align-middle mb-0">
                    <thead class="table-dark">
                        <tr>
                            <th class="ps-4">ID</th>
                            <th>Product Name</th>
                            <th>Buying Price (KES)</th>
                            <th>Selling Price (KES)</th>
                            <th>Stock Qty</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="productsTableBody">
                        <tr>
                            <td colspan="6" class="text-center py-4">
                                <div class="spinner-border text-primary" role="status">
                                    <span class="visually-hidden">Loading...</span>
                                </div>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- Add Product Modal -->
    <div class="modal fade" id="addProductModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header bg-light">
                    <h5 class="modal-title fw-bold">Add New Product</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                
                <div class="modal-body">
                    <form id="addProductForm">
                        <div class="mb-3">
                            <label class="form-label fw-bold">Product Name</label>
                            <input type="text" class="form-control" id="productName" placeholder="e.g., Blue Band 500g" required>
                        </div>

                        <div class="row">
                            <div class="col mb-3">
                                <label class="form-label fw-bold">Buying Price</label>
                                <input type="number" step="0.01" class="form-control" id="buyingPrice" placeholder="0.00" required>
                            </div>
                            <div class="col mb-3">
                                <label class="form-label fw-bold">Selling Price</label>
                                <input type="number" step="0.01" class="form-control" id="sellingPrice" placeholder="0.00" required>
                            </div>
                        </div>

                        <div class="mb-3">
                            <label class="form-label fw-bold">Initial Quantity</label>
                            <input type="number" class="form-control" id="quantity" placeholder="0" required>
                        </div>

                        <button type="submit" class="btn btn-primary w-100 py-2 fw-bold">
                            <i class="fas fa-save me-2"></i> Save Product
                        </button>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        const API_URL = 'http://localhost:8080/api';

        // Load products on page load
        document.addEventListener('DOMContentLoaded', function() {
            loadProducts();
        });

        // Load all products from API
        function loadProducts() {
            fetch(`${API_URL}/products`)
                .then(response => response.json())
                .then(products => {
                    displayProducts(products);
                })
                .catch(error => {
                    console.error('Error loading products:', error);
                    document.getElementById('productsTableBody').innerHTML = `
                        <tr>
                            <td colspan="6" class="text-center py-4 text-danger">
                                <i class="fas fa-exclamation-triangle fa-2x mb-2"></i><br>
                                Error loading products. Make sure backend is running on port 8080.
                            </td>
                        </tr>`;
                });
        }

        // Display products in table
        function displayProducts(products) {
            const tbody = document.getElementById('productsTableBody');
            
            if (products.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="6" class="text-center py-4 text-muted">
                            <i class="fas fa-box-open fa-2x mb-2"></i><br>
                            No products found. Add one to get started!
                        </td>
                    </tr>`;
                return;
            }

            tbody.innerHTML = products.map(product => `
                <tr>
                    <td class="ps-4 fw-bold">#${product.id}</td>
                    <td>${product.name}</td>
                    <td>${product.buyingPrice.toFixed(2)}</td>
                    <td>${product.sellingPrice.toFixed(2)}</td>
                    <td>
                        <span class="badge ${product.quantity < 5 ? 'bg-danger' : 'bg-success'} rounded-pill">
                            ${product.quantity}
                        </span>
                    </td>
                    <td>
                        <button class="btn btn-sm btn-outline-primary me-1" onclick="editProduct(${product.id})">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button class="btn btn-sm btn-outline-danger" onclick="deleteProduct(${product.id})">
                            <i class="fas fa-trash"></i>
                        </button>
                    </td>
                </tr>
            `).join('');
        }

        // Add new product
        document.getElementById('addProductForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const product = {
                name: document.getElementById('productName').value,
                buyingPrice: parseFloat(document.getElementById('buyingPrice').value),
                sellingPrice: parseFloat(document.getElementById('sellingPrice').value),
                quantity: parseInt(document.getElementById('quantity').value)
            };

            fetch(`${API_URL}/products`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(product)
            })
            .then(response => response.json())
            .then(data => {
                console.log('Product added:', data);
                // Close modal
                bootstrap.Modal.getInstance(document.getElementById('addProductModal')).hide();
                // Reset form
                document.getElementById('addProductForm').reset();
                // Reload products
                loadProducts();
            })
            .catch(error => {
                console.error('Error adding product:', error);
                alert('Error adding product. Please try again.');
            });
        });

        // Delete product
        function deleteProduct(id) {
            if (confirm('Are you sure you want to delete this product?')) {
                fetch(`${API_URL}/products/${id}`, {
                    method: 'DELETE'
                })
                .then(response => {
                    if (response.ok) {
                        console.log('Product deleted');
                        loadProducts();
                    } else {
                        throw new Error('Failed to delete product');
                    }
                })
                .catch(error => {
                    console.error('Error deleting product:', error);
                    alert('Error deleting product. Please try again.');
                });
            }
        }

        // Edit product (placeholder - you can implement this)
        function editProduct(id) {
            alert('Edit functionality coming soon! Product ID: ' + id);
        }
    </script>
</body>
</html>
